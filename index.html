<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Czech Badminton - ligov√© statistiky</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; }
        .kolo-checkbox { cursor: pointer; }
        .kolo-checkbox:hover { background-color: #eff6ff; }
        .soutez-tab { transition: all 0.2s; }
        .soutez-tab.active { background: linear-gradient(to right, #2563eb, #4f46e5); color: white; }
        /* Dark mode tweaks */
        .dark { background-color: #0b0b0b !important; color: #ddd !important; }
        .dark .card { background: #111 !important; color: #ddd !important; }
        .dark table { background: #161616; }
        .modal-backdrop { background: rgba(0,0,0,0.5); position: fixed; inset: 0; display: flex; align-items: center; justify-content: center; z-index: 60; }
        .modal { background: white; padding: 1rem; border-radius: 0.5rem; max-width: 720px; width: 95%; max-height: 80vh; overflow: auto; }
        .dark .modal { background: #1b1b1b; color: #ddd; }
    </style>
</head>
<body class="min-h-screen p-4 bg-gradient-to-br from-red-600 to-red-800">
  <div class="max-w-7xl mx-auto">
    <div class="card bg-white rounded-xl shadow-lg p-6 mb-6">
      <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
        <div>
          <h1 class="text-3xl font-bold text-gray-800 mb-2">üè∏ Czech Badminton - ligov√© statistiky</h1>
          <p class="text-gray-600">P≈ôehled z√°pas≈Ø, tabulky a statistiky hr√°ƒç≈Ø</p>
          <p class="text-sm text-blue-600 mt-2" id="aktualizaceInfo">Naƒç√≠t√°n√≠ dat...</p>
          <p id="hracMesice" class="mt-2 text-sm text-gray-700"></p>
        </div>
        <div class="flex gap-2 items-center">
          <button id="darkToggle" onclick="toggleDarkMode()" class="bg-gray-700 text-white px-3 py-2 rounded-lg shadow-lg">üåì Dark</button>
        </div>
      </div>

      <div class="mt-6 flex flex-wrap gap-2">
        <button onclick="zmenitSoutez('extraliga')" id="tab-extraliga" class="soutez-tab px-6 py-3 rounded-lg font-semibold">üèÜ Extraliga</button>
        <button onclick="zmenitSoutez('prvni-liga-vychod')" id="tab-prvni-liga-vychod" class="soutez-tab px-6 py-3 rounded-lg font-semibold bg-gray-200 text-gray-700">üìç 1. liga - V√Ωchod</button>
        <button onclick="zmenitSoutez('prvni-liga-zapad')" id="tab-prvni-liga-zapad" class="soutez-tab px-6 py-3 rounded-lg font-semibold bg-gray-200 text-gray-700">üìç 1. liga - Z√°pad</button>
      </div>
    </div>

    <div class="flex gap-2 mb-4">
      <button class="bg-blue-100 text-blue-700 px-3 py-1 rounded" onclick="filtrPosledniKolo()">Posledn√≠ kolo</button>
      <button class="bg-green-100 text-green-700 px-3 py-1 rounded" onclick="vyberVsechnaKola()">Aktu√°ln√≠ kolo</button>
    </div>

    <!-- Tabulka -->
    <div id="tabulkaContainer" class="card bg-white rounded-xl shadow-lg p-6 mb-6" style="display:none">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-bold text-gray-800">üèÜ Tabulka - <span id="tabulkaSoutez"></span></h2>
        <div id="bodovaniInfo" class="text-sm text-gray-600"></div>
      </div>
      <div class="overflow-x-auto">
        <table class="w-full">
          <thead>
            <tr class="bg-gradient-to-r from-green-600 to-emerald-600 text-white">
              <th class="p-2">#</th>
              <th class="p-2 text-left">T√Ωm</th>
              <th class="p-2">Utk√°n√≠</th>
              <th class="p-2">V</th>
              <th class="p-2">R</th>
              <th class="p-2">P</th>
              <th class="p-2">Z√°pasy</th>
              <th class="p-2">Sety</th>
              <th class="p-2">Body</th>
              <th class="p-2">Bod≈Ø</th>
            </tr>
          </thead>
          <tbody id="tabulkaTable"></tbody>
        </table>
      </div>
    </div>

    <!-- Statistiky -->
    <div id="statistikyContainer" class="card bg-white rounded-xl shadow-lg p-6 mb-6" style="display:none">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-bold text-gray-800">üìä Statistiky hr√°ƒç≈Ø</h2>
      </div>

      <!-- Filtry -->
      <div class="bg-gray-50 border border-gray-200 rounded-lg p-4 mb-4">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
          <div>
            <label class="block text-xs font-medium text-gray-600 mb-1">Vyhledat hr√°ƒçe</label>
            <input id="hledatHrace" oninput="zobrazitData()" class="w-full border border-gray-300 rounded px-3 py-2 text-sm" placeholder="Zadejte jm√©no..."/>
          </div>
          <div>
            <label class="block text-xs font-medium text-gray-600 mb-1">T√Ωm</label>
            <select id="filtrTym" onchange="zobrazitData()" class="w-full border border-gray-300 rounded px-3 py-2 text-sm"><option value="">V≈°echny t√Ωmy</option></select>
          </div>
          <div>
            <label class="block text-xs font-medium text-gray-600 mb-1">Min. z√°pas≈Ø</label>
            <input id="minZapasy" type="number" min="0" value="0" oninput="zobrazitData()" class="w-full border border-gray-300 rounded px-3 py-2 text-sm"/>
          </div>
        </div>

        <div class="border-t border-gray-300 pt-3 mt-3">
          <div class="flex justify-between items-center mb-2">
            <label class="text-xs font-medium text-gray-600">Filtr podle kol</label>
            <div class="flex gap-2">
              <button onclick="vyberVsechnaKola()" class="text-xs text-blue-600 hover:text-blue-800">Vybrat v≈°e</button>
              <button onclick="zrusVsechnaKola()" class="text-xs text-red-600 hover:text-red-800">Zru≈°it v≈°e</button>
            </div>
          </div>
          <div id="kolaCheckboxy" class="flex flex-wrap gap-2"></div>
        </div>
      </div>

      <div class="overflow-x-auto">
        <table class="w-full text-sm">
          <thead>
            <tr class="bg-gradient-to-r from-blue-600 to-indigo-600 text-white">
              <th class="p-2">#</th>
              <th class="p-2 text-left">Hr√°ƒç</th>
              <th class="p-2 text-left">T√Ωm</th>
              <th class="p-2">Z</th>
              <th class="p-2">V</th>
              <th class="p-2">P</th>
              <th class="p-2">Win %</th>
            </tr>
          </thead>
          <tbody id="statistikyTable"></tbody>
        </table>
      </div>
    </div>

  </div>

  <!-- Modal -->
  <div id="modal" style="display:none" class="modal-backdrop">
    <div class="modal">
      <div id="modalContent"></div>
      <div class="mt-3 text-right"><button onclick="closeModal()" class="px-3 py-1 rounded bg-gray-200">Zav≈ô√≠t</button></div>
    </div>
  </div>

<script>
/* ---------- Data containers ---------- */
let zapasy = {'extraliga': [], 'prvni-liga-vychod': [], 'prvni-liga-zapad': []};
let tymy = {'extraliga': [], 'prvni-liga-vychod': [], 'prvni-liga-zapad': []};
let vybrana_kola = new Set();
let aktualni_soutez = 'extraliga';

const soutezNazvy = {
  'extraliga': 'Extraliga',
  'prvni-liga-vychod': '1. liga - V√Ωchod',
  'prvni-liga-zapad': '1. liga - Z√°pad'
};

/* ---------- Utility parsers ---------- */
function parseVysledek(vysledek){
  if(!vysledek) return {domaci:0,hoste:0};
  const parts = vysledek.split(':');
  return {domaci: parseInt(parts[0]) || 0, hoste: parseInt(parts[1]) || 0};
}
function parseSety(sety){
  if(!sety) return {domaciBody:0,hosteBody:0};
  const setArr = sety.split(',').map(s=>s.trim());
  let dom=0, hos=0;
  setArr.forEach(set=>{
    const p=set.split(':');
    dom += parseInt(p[0]) || 0;
    hos += parseInt(p[1]) || 0;
  });
  return {domaciBody: dom, hosteBody: hos};
}
function getHraciFromTeam(team){ return team ? team.split(',').map(h=>h.trim()).filter(Boolean) : []; }

/* ---------- Data loading ---------- */
async function nacistData(){
  try{
    const res = await fetch('badminton-data.json');
    if(!res.ok) throw new Error('Soubor nenalezen');
    const data = await res.json();
    zapasy = data.zapasy || zapasy;
    tymy = data.tymy || tymy;
    document.getElementById('aktualizaceInfo').textContent = '‚úì Posledn√≠ aktualizace: ' + (data.aktualizace || '-');
    zmenitSoutez('extraliga');
  }catch(e){
    console.error(e);
    document.getElementById('aktualizaceInfo').textContent = '‚ùå Nepoda≈ôilo se naƒç√≠st data';
    document.getElementById('tabulkaContainer').style.display = 'none';
    document.getElementById('statistikyContainer').style.display = 'none';
  }
}

/* ---------- UI helpers ---------- */
function toggleDarkMode(){ document.body.classList.toggle('dark'); }
function openModal(html){ document.getElementById('modalContent').innerHTML = html; document.getElementById('modal').style.display='flex'; }
function closeModal(){ document.getElementById('modal').style.display='none'; }

/* ---------- Tabs / filters ---------- */
function zmenitSoutez(soutez){
  aktualni_soutez = soutez;
  document.querySelectorAll('.soutez-tab').forEach(t=>t.classList.remove('active'));
  document.getElementById('tab-' + soutez).classList.add('active');
  document.getElementById('tabulkaSoutez').textContent = soutezNazvy[soutez];
  vybrana_kola.clear();
  aktualizovatSelecty();
  zobrazitData();
}

function aktualizovatSelecty(){
  const filtrTym = document.getElementById('filtrTym');
  if(!filtrTym) return;
  const current = filtrTym.value;
  filtrTym.innerHTML = '<option value=\"\">V≈°echny t√Ωmy</option>' + (tymy[aktualni_soutez] || []).map(t=>`<option value=\"${t}\">${t}</option>`).join('');
  if((tymy[aktualni_soutez]||[]).includes(current)) filtrTym.value = current;
}

function aktualizovatKolaCheckboxy(){
  const vsechna = [...new Set((zapasy[aktualni_soutez]||[]).map(z=>z.kolo))].sort((a,b)=> (parseInt(a)||0) - (parseInt(b)||0));
  const container = document.getElementById('kolaCheckboxy');
  if(!vsechna.length){ container.innerHTML = '<span class=\"text-xs text-gray-500\">≈Ω√°dn√° kola</span>'; return; }
  container.innerHTML = vsechna.map(k=>{
    const checked = (vybrana_kola.size===0 || vybrana_kola.has(k)) ? 'checked' : '';
    return `<label class="kolo-checkbox flex items-center gap-1 px-3 py-1 border border-gray-300 rounded bg-white"><input type="checkbox" value="${k}" onchange="toggleKolo('${k}')" ${checked} class="w-3 h-3"/><span class="text-xs">Kolo ${k}</span></label>`;
  }).join('');
}

function toggleKolo(k){ if(vybrana_kola.has(k)) vybrana_kola.delete(k); else vybrana_kola.add(k); zobrazitData(); }
function vyberVsechnaKola(){ vybrana_kola.clear(); aktualizovatKolaCheckboxy(); zobrazitData(); }
function zrusVsechnaKola(){ vybrana_kola = new Set(); const c = document.querySelectorAll('#kolaCheckboxy input[type=\"checkbox\"]'); c.forEach(x=>x.checked=false); zobrazitData(); }

/* ---------- Statistick√© v√Ωpoƒçty ---------- */
function vypocitejStatistiky(){
  const stats = {};
  const filtrTym = document.getElementById('filtrTym') ? document.getElementById('filtrTym').value : '';
  const minZapasy = document.getElementById('minZapasy') ? parseInt(document.getElementById('minZapasy').value) : 0;

  (zapasy[aktualni_soutez]||[]).forEach(z=>{
    if(vybrana_kola.size>0 && !vybrana_kola.has(z.kolo)) return;
    const vys = parseVysledek(z.vysledek);
    const body = parseSety(z.sety);
    const domaciHraci = getHraciFromTeam(z.domaci);
    const hosteHraci = getHraciFromTeam(z.hoste);
    const domaciVyhral = vys.domaci > vys.hoste;
    const domSkrec = z.domaci === 'SKREƒå';
    const hosSkrec = z.hoste === 'SKREƒå';

    if(!domSkrec){
      domaciHraci.forEach(hrac=>{
        if(filtrTym && z.tymDomaci !== filtrTym) return;
        if(!stats[hrac]) stats[hrac] = {zapasy:0, vyhry:0, prohry:0, setVyhrane:0, setProhrane:0, bodyVyhrane:0, bodyProhrane:0, tymy:{} , last:[]};
        stats[hrac].zapasy++;
        if(domaciVyhral) stats[hrac].vyhry++; else stats[hrac].prohry++;
        stats[hrac].setVyhrane += vys.domaci;
        stats[hrac].setProhrane += vys.hoste;
        stats[hrac].bodyVyhrane += body.domaciBody;
        stats[hrac].bodyProhrane += body.hosteBody;
        stats[hrac].tymy[z.tymDomaci] = (stats[hrac].tymy[z.tymDomaci]||0)+1;
        stats[hrac].last.push({kolo:z.kolo, datum:z.datum, disciplina:z.disciplina, vysledek:z.vysledek, proti: z.hoste});
      });
    }
    if(!hosSkrec){
      hosteHraci.forEach(hrac=>{
        if(filtrTym && z.tymHoste !== filtrTym) return;
        if(!stats[hrac]) stats[hrac] = {zapasy:0, vyhry:0, prohry:0, setVyhrane:0, setProhrane:0, bodyVyhrane:0, bodyProhrane:0, tymy:{} , last:[]};
        stats[hrac].zapasy++;
        if(!domaciVyhral) stats[hrac].vyhry++; else stats[hrac].prohry++;
        stats[hrac].setVyhrane += vys.hoste;
        stats[hrac].setProhrane += vys.domaci;
        stats[hrac].bodyVyhrane += body.hosteBody;
        stats[hrac].bodyProhrane += body.domaciBody;
        stats[hrac].tymy[z.tymHoste] = (stats[hrac].tymy[z.tymHoste]||0)+1;
        stats[hrac].last.push({kolo:z.kolo, datum:z.datum, disciplina:z.disciplina, vysledek:z.vysledek, proti: z.domaci});
      });
    }
  });

  // odstranit hr√°ƒçe pod minZapasy
  Object.keys(stats).forEach(h=>{
    if(stats[h].zapasy < (document.getElementById('minZapasy')?parseInt(document.getElementById('minZapasy').value):0)){
      delete stats[h];
    }
  });

  return stats;
}

function vypocitejTabulku(){
  const tab = {}; const utk = {};
  (zapasy[aktualni_soutez]||[]).forEach(z=>{
    const key = `${z.kolo}|${z.tymDomaci}|${z.tymHoste}`;
    if(!utk[key]) utk[key] = {kolo:z.kolo, domaci:z.tymDomaci, hoste:z.tymHoste, zapasy:[]};
    utk[key].zapasy.push(z);
  });

  const jePrvni = aktualni_soutez.includes('prvni-liga');

  Object.values(utk).forEach(u=>{
    const dom = u.domaci, hos = u.hoste;
    if(!dom || !hos) return;
    if(!tab[dom]) tab[dom] = {utkani:0, vyhry:0, remizy:0, prohry:0, zapasyV:0, zapasyP:0, setyV:0, setyP:0, bodyV:0, bodyP:0, body:0};
    if(!tab[hos]) tab[hos] = JSON.parse(JSON.stringify(tab[dom] = tab[dom] || {utkani:0, vyhry:0, remizy:0, prohry:0, zapasyV:0, zapasyP:0, setyV:0, setyP:0, bodyV:0, bodyP:0, body:0}));
    let domZ=0, hosZ=0, domSet=0, hosSet=0, domBody=0, hosBody=0;
    u.zapasy.forEach(z=>{
      const v = parseVysledek(z.vysledek);
      const b = parseSety(z.sety);
      if(v.domaci > v.hoste) domZ++; else if(v.hoste > v.domaci) hosZ++;
      domSet += v.domaci; hosSet += v.hoste;
      domBody += b.domaciBody; hosBody += b.hosteBody;
    });

    let domBodyTab=0, hosBodyTab=0;
    if(jePrvni){
      if(domZ === hosZ){ domBodyTab = 2; hosBodyTab = 2; tab[dom].remizy++; tab[hos].remizy++; }
      else if(domZ > hosZ){ domBodyTab = 3; hosBodyTab = 1; tab[dom].vyhry++; tab[hos].prohry++; }
      else { hosBodyTab = 3; domBodyTab = 1; tab[hos].vyhry++; tab[dom].prohry++; }
    } else {
      const domVy = domZ > hosZ;
      if(domVy){
        if(domZ >= 6){ domBodyTab = 3; hosBodyTab = 0; }
        else if(domZ >=4){ domBodyTab = 2; hosBodyTab = 1; }
        tab[dom].vyhry++; tab[hos].prohry++;
      } else {
        if(hosZ >= 6){ hosBodyTab = 3; domBodyTab = 0; }
        else if(hosZ >=4){ hosBodyTab = 2; domBodyTab = 1; }
        tab[hos].vyhry++; tab[dom].prohry++;
      }
    }

    tab[dom].utkani++; tab[dom].zapasyV += domZ; tab[dom].zapasyP += hosZ; tab[dom].setyV += domSet; tab[dom].setyP += hosSet; tab[dom].bodyV += domBody; tab[dom].bodyP += hosBody; tab[dom].body += domBodyTab;
    tab[hos].utkani++; tab[hos].zapasyV += hosZ; tab[hos].zapasyP += domZ; tab[hos].setyV += hosSet; tab[hos].setyP += domSet; tab[hos].bodyV += hosBody; tab[hos].bodyP += domBody; tab[hos].body += hosBodyTab;
  });

  return tab;
}

/* ---------- Helpers for UI formatting ---------- */
function formatDiff(val){
  const arrow = val > 0 ? '‚ñ≤' : val < 0 ? '‚ñº' : '‚Äì';
  const cls = val > 0 ? 'text-green-600' : val < 0 ? 'text-red-600' : 'text-gray-400';
  return `<span class="${cls} ml-1 text-xs">${arrow}${val>=0?'+':''}${val}</span>`;
}

/* ---------- Clickable details ---------- */
function zobrazTymDetail(tym){
  const all = (zapasy[aktualni_soutez]||[]).filter(z=>z.tymDomaci===tym || z.tymHoste===tym);
  const doma = all.filter(z=>z.tymDomaci===tym);
  const venku = all.filter(z=>z.tymHoste===tym);
  const html = `<h3 class="text-lg font-semibold mb-2">${tym}</h3><p>Doma: ${doma.length} z√°pas≈Ø<br/>Venku: ${venku.length} z√°pas≈Ø</p><hr/><div style="margin-top:0.5rem;">${all.slice().reverse().map(z=>`<div class="py-1 border-b"><strong>Kolo ${z.kolo}</strong> ‚Äî ${z.datum || '-'} ‚Äî ${z.disciplina || '-'} ‚Äî ${z.vysledek || '-'}</div>`).join('')}</div>`;
  openModal(html);
}

function zobrazDetailHrace(jmeno){
  const all = (zapasy[aktualni_soutez]||[]).filter(z=> (z.domaci||'').includes(jmeno) || (z.hoste||'').includes(jmeno));
  const poslednich = all.slice(-5).reverse();
  const html = `<h3 class="text-lg font-semibold mb-2">${jmeno}</h3>` + (poslednich.length ? `<div>${poslednich.map(z=>`<div class="py-1 border-b"><strong>${z.disciplina}</strong> ‚Äî ${z.kolo} ‚Äî ${z.vysledek} ‚Äî proti: ${ (z.domaci||'').includes(jmeno) ? z.hoste : z.domaci }</div>`).join('')}</div>` : '<p>≈Ω√°dn√© z√°pasy</p>');
  openModal(html);
}

/* ---------- Render UI ---------- */
function zobrazitData(){
  // pr√°zdn√Ω stav
  if(!(zapasy[aktualni_soutez]||[]).length){
    document.getElementById('tabulkaContainer').style.display='none';
    document.getElementById('statistikyContainer').style.display='none';
    return;
  }
  document.getElementById('tabulkaContainer').style.display='block';
  document.getElementById('statistikyContainer').style.display='block';

  // kola
  aktualizovatKolaCheckboxy();

  // hrac mesice
  document.getElementById('hracMesice').textContent = '‚≠ê Hr√°ƒç mƒõs√≠ce: ' + (hracMesice() || '-');

  // STATISTIKY
  const stats = vypocitejStatistiky();
  let hraci = Object.keys(stats);
  const hled = document.getElementById('hledatHrace').value.toLowerCase();
  if(hled) hraci = hraci.filter(h=>h.toLowerCase().includes(hled));
  const razeni = 'winrate'; // for simplicity keep default sort by winrate
  hraci.sort((a,b)=>{
    const A = stats[a], B = stats[b];
    const wrA = A.zapasy? A.vyhry / A.zapasy : 0;
    const wrB = B.zapasy? B.vyhry / B.zapasy : 0;
    if(Math.abs(wrB-wrA) > 0.0001) return wrB-wrA;
    return B.zapasy - A.zapasy;
  });

  const statTable = document.getElementById('statistikyTable');
  statTable.innerHTML = '';
  hraci.forEach((h, idx)=>{
    const s = stats[h];
    const winPct = s.zapasy ? ((s.vyhry / s.zapasy)*100).toFixed(1) : '0.0';
    const nej = Object.keys(s.tymy || {})[0] || '-';
    const row = document.createElement('tr');
    row.className = 'border-b border-gray-200 hover:bg-blue-50';
    row.innerHTML =
      `<td class="p-2 text-center font-bold">${idx+1}</td>` +
      `<td class="p-2 font-semibold cursor-pointer text-blue-700" onclick="zobrazDetailHrace('${h.replace(/'/g,"\\'")}')">${h}</td>` +
      `<td class="p-2 text-blue-600 cursor-pointer" onclick="zobrazTymDetail('${nej.replace(/'/g,"\\'")}')">${nej}</td>` +
      `<td class="p-2 text-center">${s.zapasy}</td>` +
      `<td class="p-2 text-center text-green-600 font-semibold">${s.vyhry}</td>` +
      `<td class="p-2 text-center text-red-600 font-semibold">${s.prohry}</td>` +
      `<td class="p-2 text-center font-bold ${parseFloat(winPct) >= 50 ? 'text-green-600' : 'text-red-600'}">${winPct}%</td>`;
    statTable.appendChild(row);
  });

  // TABULKA
  const tabData = vypocitejTabulku();
  let teamKeys = Object.keys(tabData);
  teamKeys.sort((a,b)=>{
    const A = tabData[a], B = tabData[b];
    if(B.body !== A.body) return B.body - A.body;
    if(B.vyhry !== A.vyhry) return B.vyhry - A.vyhry;
    const diffA = (A.zapasyV - A.zapasyP), diffB = (B.zapasyV - B.zapasyP);
    if(diffB !== diffA) return diffB - diffA;
    const setA = (A.setyV - A.setyP), setB = (B.setyV - B.setyP);
    if(setB !== setA) return setB - setA;
    return (B.bodyV - B.bodyP) - (A.bodyV - A.bodyP);
  });

  const tableBody = document.getElementById('tabulkaTable');
  tableBody.innerHTML = '';
  teamKeys.forEach((t, idx)=>{
    const rowData = tabData[t];
    const rZap = rowData.zapasyV - rowData.zapasyP;
    const rSet = rowData.setyV - rowData.setyP;
    const rBody = rowData.bodyV - rowData.bodyP;
    let pozCls = '';
    if(idx===0) pozCls='bg-yellow-100 font-bold';
    else if(idx===1) pozCls='bg-gray-100 font-bold';
    else if(idx===2) pozCls='bg-orange-100 font-bold';
    const row = document.createElement('tr');
    row.className = 'border-b border-gray-200 hover:bg-green-50';
    row.innerHTML =
      `<td class="p-2 text-center font-bold ${pozCls}">${idx+1}.</td>` +
      `<td class="p-2 font-semibold ${pozCls} cursor-pointer text-blue-700" onclick="zobrazTymDetail('${t.replace(/'/g,"\\'")}')">${t}</td>` +
      `<td class="p-2 text-center">${rowData.utkani}</td>` +
      `<td class="p-2 text-center text-green-600 font-semibold">${rowData.vyhry}</td>` +
      `<td class="p-2 text-center text-yellow-600 font-semibold">${rowData.remizy}</td>` +
      `<td class="p-2 text-center text-red-600 font-semibold">${rowData.prohry}</td>` +
      `<td class="p-2 text-center text-sm">${rowData.zapasyV}:${rowData.zapasyP} ${formatDiff(rZap)}</td>` +
      `<td class="p-2 text-center text-sm">${rowData.setyV}:${rowData.setyP} ${formatDiff(rSet)}</td>` +
      `<td class="p-2 text-center text-sm">${rowData.bodyV}:${rowData.bodyP} ${formatDiff(rBody)}</td>` +
      `<td class="p-2 text-center font-bold text-lg text-blue-700">${rowData.body}</td>`;
    tableBody.appendChild(row);
  });

}

/* ---------- Extra computations ---------- */
function hracMesice(){
  const stats = vypocitejStatistiky();
  const arr = Object.entries(stats).filter(([_,s])=>s.zapasy >= 3);
  arr.sort((a,b)=> (b[1].vyhry / b[1].zapasy) - (a[1].vyhry / a[1].zapasy));
  return arr[0] ? arr[0][0] : '';
}

/* ---------- Initialisation ---------- */
nacistData();

/* Fallback: if no data file is present, create demo data so UI is visible (won't overwrite your file) */
setTimeout(()=>{
  if((zapasy['extraliga']||[]).length === 0){
    zapasy['extraliga'] = [
      {kolo:'1', datum:'2025-10-01', disciplina:'Sm√≠≈°en√°', tymDomaci:'SK Prosek', domaci:'Kl√°ra, Radka', tymHoste:'TJ Sokol', hoste:'Petr, Jan', vysledek:'5:3', sety:'21:15,18:21,21:19'},
      {kolo:'1', datum:'2025-10-01', disciplina:'Dvouhra', tymDomaci:'ABC', domaci:'Karel', tymHoste:'SK Prosek', hoste:'Kl√°ra', vysledek:'2:6', sety:'12:21,11:21'},
      {kolo:'2', datum:'2025-10-08', disciplina:'ƒåty≈ôhra', tymDomaci:'SK Prosek', domaci:'Kl√°ra, Karel', tymHoste:'XYZ', hoste:'Jan, Petr', vysledek:'4:4', sety:'21:19,19:21,21:18'}
    ];
    tymy['extraliga'] = ['SK Prosek','TJ Sokol','ABC','XYZ'];
    zmenitSoutez('extraliga');
  }
}, 500);

/* expose some functions for onclick attributes in generated HTML (needed in some browsers) */
window.zobrazDetailHrace = zobrazDetailHrace;
window.zobrazTymDetail = zobrazTymDetail;
window.filtrPosledniKolo = function(){ const vse = [...new Set((zapasy[aktualni_soutez]||[]).map(z=>z.kolo))]; const posled = vse.sort((a,b)=>(parseInt(a)||0)-(parseInt(b)||0)).pop(); vybrana_kola = new Set([posled]); zobrazitData(); };
window.vyberVsechnaKola = vyberVsechnaKola;
window.zrusVsechnaKola = zrusVsechnaKola;

</script>
</body>
</html>
